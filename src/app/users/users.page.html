<div class="users-page">
  <div class="page-header">
    <div>
      <h1>Users</h1>
      <p>Manage all registered users</p>
    </div>
    <div class="header-actions" *ngIf="!loading">
      <span class="user-count">{{ filteredUsers.length }} users</span>
      <button class="export-btn" (click)="exportCSV()" *ngIf="filteredUsers.length > 0">
        <ion-icon name="download-outline"></ion-icon>
        Export CSV
      </button>
    </div>
  </div>

  <!-- Filter Bar -->
  <div class="filter-bar">
    <div class="search-bar">
      <ion-icon name="search-outline"></ion-icon>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (ngModelChange)="onFilterChange()"
        placeholder="Search by name or email..."
      />
    </div>
    <div class="filter-group">
      <select [(ngModel)]="filterRole" (ngModelChange)="onFilterChange()">
        <option value="all">All Roles</option>
        <option value="admin">Admin</option>
        <option value="user">User</option>
      </select>
      <select [(ngModel)]="filterGender" (ngModelChange)="onFilterChange()">
        <option value="all">All Genders</option>
        <option value="Male">Male</option>
        <option value="Female">Female</option>
        <option value="Other">Other</option>
      </select>
      <select [(ngModel)]="sortBy" (ngModelChange)="onFilterChange()">
        <option value="name">Sort by Name</option>
        <option value="date">Sort by Joined</option>
        <option value="role">Sort by Role</option>
      </select>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-container" *ngIf="loading">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading users...</p>
  </div>

  <!-- Error -->
  <div class="error-container" *ngIf="error && !loading">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>{{ error }}</p>
    <button class="retry-btn" (click)="loadUsers()">Retry</button>
  </div>

  <!-- Users Table -->
  <div class="table-container" *ngIf="!loading && !error">
    <table class="users-table" *ngIf="filteredUsers.length > 0">
      <thead>
        <tr>
          <th>User</th>
          <th>Email</th>
          <th>Role</th>
          <th>Gender</th>
          <th>Age</th>
          <th>Joined</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let user of filteredUsers" (click)="viewUser(user.uid)" class="clickable-row">
          <td>
            <div class="user-cell">
              <div class="avatar">{{ getInitials(user) }}</div>
              <span class="user-name">{{ getDisplayName(user) }}</span>
            </div>
          </td>
          <td>{{ user.email }}</td>
          <td>
            <span class="role-badge" [class.admin]="user.role === 'admin'">{{ user.role || 'user' }}</span>
          </td>
          <td>{{ user.gender || '-' }}</td>
          <td>{{ user.age || '-' }}</td>
          <td>{{ formatDate(user.createdAt) }}</td>
          <td>
            <button class="view-btn" (click)="viewUser(user.uid); $event.stopPropagation()">
              <ion-icon name="eye-outline"></ion-icon>
              View
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="empty-state" *ngIf="filteredUsers.length === 0">
      <ion-icon name="people-outline"></ion-icon>
      <p *ngIf="searchQuery">No users match "{{ searchQuery }}"</p>
      <p *ngIf="!searchQuery">No users found</p>
    </div>
  </div>
</div>
